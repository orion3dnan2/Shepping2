# دليل نشر التطبيق على Render

## متطلبات النشر

### 1. ملفات المطلوبة:
- `main.py` - نقطة دخول التطبيق
- `app.py` - إعداد Flask والقاعدة
- `models.py` - نماذج قاعدة البيانات
- `routes.py` - مسارات التطبيق
- `Procfile` - أوامر تشغيل الخادم
- `runtime.txt` - إصدار Python المطلوب
- `requirements.txt` - قائمة المتطلبات

### 2. متطلبات Python (requirements.txt):
```
Flask==2.3.3
Flask-SQLAlchemy==3.0.5
Flask-Login==0.6.3
Flask-Migrate==4.0.5
psycopg2-binary==2.9.10
Werkzeug==2.3.7
SQLAlchemy==2.0.23
gunicorn==21.2.0
email-validator==2.1.0
PyJWT==2.8.0
```

### 3. متغيرات البيئة المطلوبة في Render:
- `DATABASE_URL` - رابط قاعدة بيانات PostgreSQL
- `SESSION_SECRET` - مفتاح التشفير للجلسات

## خطوات النشر على Render

### الخطوة 1: إنشاء قاعدة بيانات PostgreSQL
1. اذهب إلى Render Dashboard
2. انقر على "New" → "PostgreSQL"
3. اختر اسم قاعدة البيانات
4. احفظ الـ `DATABASE_URL` المُولد

### الخطوة 2: إنشاء Web Service
1. انقر على "New" → "Web Service"
2. اربط مستودع GitHub الخاص بك
3. اختر البرانش المناسب
4. املأ الإعدادات:
   - **Name**: اسم التطبيق
   - **Environment**: Python 3
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn --bind 0.0.0.0:$PORT main:app`

### الخطوة 3: إعداد متغيرات البيئة
في إعدادات Web Service، أضف:
- `DATABASE_URL`: الرابط من قاعدة البيانات PostgreSQL
- `SESSION_SECRET`: مفتاح عشوائي آمن

### الخطوة 4: النشر
1. انقر على "Create Web Service"
2. انتظر اكتمال البناء والنشر
3. افتح الرابط المُولد لاختبار التطبيق

## حل المشاكل الشائعة

### خطأ SQLAlchemy (g64ph)
هذا الخطأ يحدث بسبب:
- رابط قاعدة البيانات غير صحيح
- عدم تطابق إصدار PostgreSQL
- مشاكل في الاتصال

**الحل:**
1. تأكد من صحة `DATABASE_URL`
2. تأكد من تشغيل قاعدة البيانات PostgreSQL  
3. راجع سجلات الأخطاء في Render

### مشكلة البورت (Port 10000)
إذا ظهر في السجلات أن التطبيق يعمل على بورت 10000 بدلاً من البورت المحدد:

**الحل:**
1. تأكد من أن Procfile يحتوي على: `web: gunicorn --bind 0.0.0.0:$PORT --workers 1 --timeout 120 main:app`
2. تأكد من إعداد متغير البيئة PORT في Render
3. لا تحدد البورت يدوياً في الكود

### مسارات الصفحات لا تعمل
إذا كانت صفحة Settings تعمل ولكن صفحات أخرى تعطي 404:

**الحل:**
1. تحقق من وجود جميع المسارات في routes.py
2. تأكد من إضافة مسارات بديلة (مثل /financial-center و /financial_center)
3. راجع import statements في app.py

### خطأ في إنشاء الجداول
إذا فشل إنشاء جداول قاعدة البيانات:
1. تأكد من وجود جميع النماذج في `models.py`
2. تأكد من استيراد جميع النماذج في `app.py`
3. راجع سجلات التطبيق

### أداء بطيء
لتحسين الأداء:
1. راجع إعدادات connection pool في `app.py`
2. تأكد من فهرسة قاعدة البيانات
3. راقب استخدام الذاكرة

## الصيانة

### تحديث التطبيق:
1. ادفع التحديثات إلى GitHub
2. Render سيعيد النشر تلقائياً

### مراقبة النشاط:
- راجع سجلات التطبيق في Render Dashboard
- راقب استخدام قاعدة البيانات
- تحقق من حالة الخدمة دورياً

## معلومات إضافية

### الأمان:
- تم تفعيل HTTPS تلقائياً
- استخدم متغيرات البيئة للمعلومات الحساسة
- لا تضع كلمات المرور في الكود

### النسخ الاحتياطي:
- Render يحتفظ بنسخ احتياطية من قاعدة البيانات
- يُنصح بإنشاء نسخ احتياطية إضافية

### الدعم:
- راجع وثائق Render الرسمية
- تحقق من Community Forum للمساعدة