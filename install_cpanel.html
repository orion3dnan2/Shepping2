<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تثبيت نظام إدارة الشحن على cPanel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px 0;
        }
        
        .install-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5rem;
            font-weight: 700;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .step {
            padding: 30px;
            border-bottom: 1px solid #eee;
        }
        
        .step:last-child {
            border-bottom: none;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-left: 15px;
            flex-shrink: 0;
        }
        
        .step-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            direction: ltr;
            text-align: left;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #856404;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #155724;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #0c5460;
        }
        
        .file-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #dee2e6;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-icon {
            margin-left: 10px;
            color: #6c757d;
        }
        
        .copy-btn {
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 0.8rem;
            cursor: pointer;
            margin-right: 10px;
        }
        
        .copy-btn:hover {
            background: #0056b3;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #28a745 0%, #20c997 100%);
            height: 6px;
            border-radius: 3px;
            margin: 20px 0;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .database-form {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .form-control {
            border-radius: 8px;
            border: 2px solid #e9ecef;
            padding: 12px 15px;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="install-container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-shipping-fast"></i> مرسال إكسبرس</h1>
            <p>دليل التثبيت الشامل على cPanel</p>
        </div>
        
        <!-- Navigation Tabs -->
        <div class="p-4">
            <ul class="nav nav-pills nav-justified" id="installTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="database-tab" data-bs-toggle="pill" data-bs-target="#database" type="button">
                        <i class="fas fa-database"></i> إنشاء قاعدة البيانات
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="files-tab" data-bs-toggle="pill" data-bs-target="#files" type="button">
                        <i class="fas fa-file-upload"></i> رفع الملفات
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="config-tab" data-bs-toggle="pill" data-bs-target="#config" type="button">
                        <i class="fas fa-cog"></i> التكوين
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="test-tab" data-bs-toggle="pill" data-bs-target="#test" type="button">
                        <i class="fas fa-check-circle"></i> الاختبار
                    </button>
                </li>
            </ul>
        </div>
        
        <div class="tab-content">
            <!-- Database Creation Tab -->
            <div class="tab-pane fade show active" id="database" role="tabpanel">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">1</span>
                        إنشاء قاعدة بيانات MySQL
                    </div>
                    
                    <div class="info">
                        <strong><i class="fas fa-info-circle"></i> ملاحظة مهمة:</strong>
                        سنقوم بإنشاء قاعدة بيانات MySQL وتكوينها للعمل مع نظام الشحن.
                    </div>
                    
                    <div class="database-form">
                        <h5>معلومات قاعدة البيانات</h5>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم قاعدة البيانات</label>
                                <input type="text" class="form-control" id="dbName" placeholder="shipping_system">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">اسم المستخدم</label>
                                <input type="text" class="form-control" id="dbUser" placeholder="shipping_user">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">كلمة المرور</label>
                                <input type="password" class="form-control" id="dbPassword" placeholder="كلمة مرور قوية">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">خادم قاعدة البيانات</label>
                                <input type="text" class="form-control" id="dbHost" value="localhost" readonly>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="generateDatabaseConfig()">
                            <i class="fas fa-magic"></i> توليد كود الاتصال
                        </button>
                    </div>
                    
                    <h6><strong>خطوات إنشاء قاعدة البيانات في cPanel:</strong></h6>
                    <ol>
                        <li>ادخل إلى cPanel واختر "MySQL Databases"</li>
                        <li>أنشئ قاعدة بيانات جديدة باسم "shipping_system"</li>
                        <li>أنشئ مستخدم جديد مع كلمة مرور قوية</li>
                        <li>اربط المستخدم بقاعدة البيانات مع صلاحيات كاملة</li>
                        <li>احفظ معلومات الاتصال للخطوة التالية</li>
                    </ol>
                    
                    <div class="code-block" id="connectionString" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>سلسلة الاتصال:</strong>
                            <button class="copy-btn" onclick="copyToClipboard('connectionString')">نسخ</button>
                        </div>
                        <div id="connectionCode"></div>
                    </div>
                </div>
            </div>
            
            <!-- Files Upload Tab -->
            <div class="tab-pane fade" id="files" role="tabpanel">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">2</span>
                        رفع ملفات التطبيق
                    </div>
                    
                    <div class="warning">
                        <strong><i class="fas fa-exclamation-triangle"></i> تنبيه:</strong>
                        تأكد من رفع جميع الملفات إلى المجلد الصحيح في cPanel.
                    </div>
                    
                    <div class="file-list">
                        <h6><strong>الملفات المطلوبة:</strong></h6>
                        <div class="file-item">
                            <i class="fas fa-file-code file-icon"></i>
                            <span>app.py</span>
                            <small class="text-muted mx-2">- ملف التطبيق الرئيسي</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code file-icon"></i>
                            <span>main.py</span>
                            <small class="text-muted mx-2">- نقطة بداية التطبيق</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code file-icon"></i>
                            <span>models.py</span>
                            <small class="text-muted mx-2">- نماذج قاعدة البيانات</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code file-icon"></i>
                            <span>routes.py</span>
                            <small class="text-muted mx-2">- مسارات التطبيق</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-file-code file-icon"></i>
                            <span>translations.py</span>
                            <small class="text-muted mx-2">- ترجمات النظام</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-folder file-icon"></i>
                            <span>templates/</span>
                            <small class="text-muted mx-2">- قوالب HTML</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-folder file-icon"></i>
                            <span>static/</span>
                            <small class="text-muted mx-2">- ملفات CSS و JS</small>
                        </div>
                        <div class="file-item">
                            <i class="fas fa-database file-icon"></i>
                            <span>instance/shipping.db</span>
                            <small class="text-muted mx-2">- قاعدة البيانات الأولية</small>
                        </div>
                    </div>
                    
                    <h6><strong>خطوات رفع الملفات:</strong></h6>
                    <ol>
                        <li>ادخل إلى File Manager في cPanel</li>
                        <li>انتقل إلى مجلد public_html</li>
                        <li>أنشئ مجلد جديد للتطبيق (مثل: shipping)</li>
                        <li>ارفع جميع الملفات إلى المجلد الجديد</li>
                        <li>تأكد من الحفاظ على هيكل المجلدات</li>
                    </ol>
                </div>
            </div>
            
            <!-- Configuration Tab -->
            <div class="tab-pane fade" id="config" role="tabpanel">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">3</span>
                        تكوين التطبيق
                    </div>
                    
                    <h6><strong>إنشاء ملف .htaccess:</strong></h6>
                    <div class="code-block">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>.htaccess</strong>
                            <button class="copy-btn" onclick="copyToClipboard('htaccessCode')">نسخ</button>
                        </div>
                        <div id="htaccessCode">
RewriteEngine On
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ main.py [QSA,L]

# Environment Variables
SetEnv SESSION_SECRET "your-secure-random-session-key-here"
SetEnv DATABASE_URL "mysql+pymysql://username:password@localhost/database_name"

# Python Configuration
PassengerPython /home/cpanelusername/virtualenv/public_html/shipping/3.11/bin/python
PassengerAppRoot /home/cpanelusername/public_html/shipping
PassengerStartupFile main.py
PassengerAppType wsgi
                        </div>
                    </div>
                    
                    <h6><strong>إنشاء ملف passenger_wsgi.py:</strong></h6>
                    <div class="code-block">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>passenger_wsgi.py</strong>
                            <button class="copy-btn" onclick="copyToClipboard('passengerCode')">نسخ</button>
                        </div>
                        <div id="passengerCode">
import sys
import os

# Add your project directory to the sys.path
sys.path.insert(0, os.path.dirname(__file__))

from app import app as application

if __name__ == "__main__":
    application.run()
                        </div>
                    </div>
                    
                    <h6><strong>تحديث app.py لدعم MySQL:</strong></h6>
                    <div class="code-block">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong>إضافة إلى app.py</strong>
                            <button class="copy-btn" onclick="copyToClipboard('mysqlConfig')">نسخ</button>
                        </div>
                        <div id="mysqlConfig">
# MySQL Database Configuration for cPanel
database_url = os.environ.get("DATABASE_URL")

if not database_url:
    # Default MySQL connection for cPanel
    database_url = "mysql+pymysql://username:password@localhost/database_name"

# Ensure MySQL format
if database_url.startswith("mysql://"):
    database_url = database_url.replace("mysql://", "mysql+pymysql://", 1)

app.config["SQLALCHEMY_DATABASE_URI"] = database_url
app.config["SQLALCHEMY_ENGINE_OPTIONS"] = {
    "pool_recycle": 3600,
    "pool_pre_ping": True,
    "pool_size": 3,
    "max_overflow": 2,
    "echo": False,
    "connect_args": {
        "charset": "utf8mb4",
        "init_command": "SET sql_mode='STRICT_TRANS_TABLES'",
    }
}
                        </div>
                    </div>
                    
                    <div class="info">
                        <strong><i class="fas fa-lightbulb"></i> نصيحة:</strong>
                        استبدل username، password، database_name بالقيم الصحيحة من قاعدة البيانات التي أنشأتها.
                    </div>
                </div>
            </div>
            
            <!-- Testing Tab -->
            <div class="tab-pane fade" id="test" role="tabpanel">
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">4</span>
                        اختبار التثبيت
                    </div>
                    
                    <h6><strong>خطوات الاختبار:</strong></h6>
                    <ol>
                        <li>
                            <strong>تثبيت المكتبات المطلوبة:</strong>
                            <div class="code-block">
pip install Flask Flask-SQLAlchemy Flask-Login pymysql cryptography
                            </div>
                        </li>
                        <li>
                            <strong>زيارة موقعك:</strong>
                            <p>اذهب إلى: <code>https://yourdomain.com/shipping/</code></p>
                        </li>
                        <li>
                            <strong>تسجيل الدخول:</strong>
                            <div class="info">
                                <strong>بيانات الدخول الافتراضية:</strong><br>
                                اسم المستخدم: <code>admin</code><br>
                                كلمة المرور: <code>admin123</code>
                            </div>
                        </li>
                        <li><strong>اختبار إنشاء شحنة جديدة</strong></li>
                        <li><strong>اختبار طباعة الفواتير</strong></li>
                        <li><strong>اختبار تتبع الشحنات</strong></li>
                    </ol>
                    
                    <div class="success">
                        <h6><strong><i class="fas fa-check-circle"></i> علامات النجاح:</strong></h6>
                        <ul class="mb-0">
                            <li>صفحة تسجيل الدخول تظهر بشكل صحيح</li>
                            <li>يمكن تسجيل الدخول بنجاح</li>
                            <li>لوحة التحكم تحمل بدون أخطاء</li>
                            <li>يمكن إنشاء شحنات جديدة</li>
                            <li>طباعة الفواتير تعمل</li>
                        </ul>
                    </div>
                    
                    <div class="warning">
                        <h6><strong><i class="fas fa-exclamation-triangle"></i> مشاكل شائعة وحلولها:</strong></h6>
                        <ul class="mb-0">
                            <li><strong>خطأ قاعدة البيانات:</strong> تحقق من معلومات الاتصال في .htaccess</li>
                            <li><strong>خطأ 500:</strong> تحقق من مسار Python في PassengerPython</li>
                            <li><strong>ملفات لا تحمل:</strong> تحقق من أذونات الملفات (755 للمجلدات، 644 للملفات)</li>
                            <li><strong>CSS لا يعمل:</strong> تحقق من مسار مجلد static</li>
                        </ul>
                    </div>
                    
                    <div class="text-center mt-4">
                        <button class="btn btn-success btn-lg" onclick="window.open('/', '_blank')">
                            <i class="fas fa-rocket"></i> اختبار التطبيق الآن
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function generateDatabaseConfig() {
            const dbName = document.getElementById('dbName').value || 'shipping_system';
            const dbUser = document.getElementById('dbUser').value || 'shipping_user';
            const dbPassword = document.getElementById('dbPassword').value || 'your_password';
            const dbHost = document.getElementById('dbHost').value || 'localhost';
            
            const connectionString = `mysql+pymysql://${dbUser}:${dbPassword}@${dbHost}/${dbName}`;
            
            document.getElementById('connectionCode').textContent = connectionString;
            document.getElementById('connectionString').style.display = 'block';
            
            // Update .htaccess code
            const htaccessCode = document.getElementById('htaccessCode');
            htaccessCode.innerHTML = htaccessCode.innerHTML.replace(
                'mysql+pymysql://username:password@localhost/database_name',
                connectionString
            );
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                // Show success message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'تم النسخ!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '#007bff';
                }, 2000);
            });
        }
        
        // Auto-advance tabs on completion
        function nextTab(currentTab) {
            const tabs = ['database-tab', 'files-tab', 'config-tab', 'test-tab'];
            const currentIndex = tabs.indexOf(currentTab);
            if (currentIndex < tabs.length - 1) {
                const nextTabButton = document.getElementById(tabs[currentIndex + 1]);
                nextTabButton.click();
            }
        }
    </script>
</body>
</html>